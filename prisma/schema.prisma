generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Category {
  id          Int       @id @default(autoincrement())
  name        String    @db.VarChar(100)
  slug        String    @unique @db.VarChar(100)
  description String?   @db.Text
  imageUrl    String?   @db.Text @map("image_url")
  isFeatured  Boolean   @default(false) @map("is_featured")
  displayOrder Int      @default(0) @map("display_order")
  active      Boolean   @default(true)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at")

  products    Product[]

  @@index([isFeatured])
  @@index([active])
  @@map("categories")
}

model Product {
  id            Int       @id @default(autoincrement())
  name          String    @db.VarChar(255)
  slug          String    @unique @db.VarChar(255)
  description   String?   @db.Text
  shortDesc     String?   @db.VarChar(500) @map("short_desc")

  price         Decimal   @db.Decimal(10, 2)
  oldPrice      Decimal?  @db.Decimal(10, 2) @map("old_price")
  costPrice     Decimal?  @db.Decimal(10, 2) @map("cost_price")

  stock         Int       @default(0)
  minStock      Int       @default(5) @map("min_stock")
  stockStatus   String    @default("in_stock") @map("stock_status")

  categoryId    Int       @map("category_id")
  category      Category  @relation(fields: [categoryId], references: [id])

  images        String[]  @default([])
  thumbnail     String?   @db.Text

  brand         String?   @db.VarChar(100)
  model         String?   @db.VarChar(100)
  voltage       String?   @db.VarChar(50)
  power         String?   @db.VarChar(50)
  weight        String?   @db.VarChar(50)
  dimensions    String?   @db.VarChar(100)
  warranty      String?   @db.VarChar(100)
  specifications Json?

  freeShipping  Boolean   @default(false) @map("free_shipping")
  shippingWeight Decimal?  @db.Decimal(10, 2) @map("shipping_weight")
  shippingWidth  Int?      @map("shipping_width")
  shippingHeight Int?      @map("shipping_height")
  shippingLength Int?      @map("shipping_length")

  rating        Decimal   @default(0) @db.Decimal(3, 2)
  reviewsCount  Int       @default(0) @map("reviews_count")

  metaTitle     String?   @db.VarChar(255) @map("meta_title")
  metaDesc      String?   @db.VarChar(500) @map("meta_desc")

  active        Boolean   @default(true)
  featured      Boolean   @default(false)

  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  cartItems     CartItem[]
  orderItems    OrderItem[]
  reviews       Review[]
  favorites     Favorite[]

  @@index([categoryId])
  @@index([active])
  @@index([slug])
  @@map("products")
}

model User {
  id        String    @id
  email     String    @unique @db.VarChar(255)
  name      String?   @db.VarChar(255)
  phone     String?   @db.VarChar(20)
  cpf       String?   @unique @db.VarChar(14)
  isAdmin   Boolean   @default(false) @map("is_admin")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  addresses Address[]
  cartItems CartItem[]
  orders    Order[]
  reviews   Review[]
  favorites Favorite[]

  @@map("users")
}

model Address {
  id           Int       @id @default(autoincrement())
  userId       String    @map("user_id")
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  name         String    @db.VarChar(100)
  phone        String?   @db.VarChar(20)
  cpf          String?   @db.VarChar(14)
  street       String    @db.VarChar(255)
  number       String    @db.VarChar(20)
  complement   String?   @db.VarChar(100)
  neighborhood String    @db.VarChar(100)
  city         String    @db.VarChar(100)
  state        String    @db.VarChar(2)
  zipCode      String    @db.VarChar(9) @map("zip_code")
  isDefault    Boolean   @default(false) @map("is_default")
  createdAt    DateTime  @default(now()) @map("created_at")

  orders       Order[]

  @@index([userId])
  @@map("addresses")
}

model CartItem {
  id        Int       @id @default(autoincrement())
  userId    String    @map("user_id")
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  productId Int       @map("product_id")
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  quantity  Int       @default(1)
  createdAt DateTime  @default(now()) @map("created_at")

  @@unique([userId, productId])
  @@index([userId])
  @@map("cart_items")
}

model Order {
  id              Int       @id @default(autoincrement())
  orderNumber     String    @unique @map("order_number")
  userId          String    @map("user_id")
  user            User      @relation(fields: [userId], references: [id])

  subtotal        Decimal   @db.Decimal(10, 2)
  shippingCost    Decimal   @db.Decimal(10, 2) @map("shipping_cost")
  discount        Decimal   @default(0) @db.Decimal(10, 2)
  total           Decimal   @db.Decimal(10, 2)

  status          String    @default("pending")
  paymentStatus   String    @default("pending") @map("payment_status")
  paymentMethod   String?   @map("payment_method")
  paymentId       String?   @map("payment_id")

  addressId       Int?      @map("address_id")
  address         Address?  @relation(fields: [addressId], references: [id])

  shippingName    String    @map("shipping_name")
  shippingPhone   String?   @map("shipping_phone")
  shippingCpf     String?   @map("shipping_cpf")
  shippingStreet  String    @map("shipping_street")
  shippingNumber  String    @map("shipping_number")
  shippingComplement String? @map("shipping_complement")
  shippingNeighborhood String @map("shipping_neighborhood")
  shippingCity    String    @map("shipping_city")
  shippingState   String    @map("shipping_state")
  shippingZipCode String    @map("shipping_zip_code")

  shippingMethod  String?   @map("shipping_method")
  trackingCode    String?   @map("tracking_code")
  estimatedDelivery DateTime? @map("estimated_delivery")
  melhorEnvioId   String?   @map("melhor_envio_id")

  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  paidAt          DateTime? @map("paid_at")
  shippedAt       DateTime? @map("shipped_at")
  deliveredAt     DateTime? @map("delivered_at")

  items           OrderItem[]

  @@index([userId])
  @@index([status])
  @@index([orderNumber])
  @@map("orders")
}

model OrderItem {
  id           Int       @id @default(autoincrement())
  orderId      Int       @map("order_id")
  order        Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId    Int       @map("product_id")
  product      Product   @relation(fields: [productId], references: [id])

  productName  String    @db.VarChar(255) @map("product_name")
  productImage String?   @db.Text @map("product_image")
  quantity     Int
  price        Decimal   @db.Decimal(10, 2)
  createdAt    DateTime  @default(now()) @map("created_at")

  @@index([orderId])
  @@map("order_items")
}

model Review {
  id        Int       @id @default(autoincrement())
  productId Int       @map("product_id")
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  userId    String    @map("user_id")
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  rating    Int
  comment   String?   @db.Text
  images    String[]  @default([])
  helpful   Int       @default(0)
  createdAt DateTime  @default(now()) @map("created_at")

  @@index([productId])
  @@map("reviews")
}

model Favorite {
  id        Int       @id @default(autoincrement())
  userId    String    @map("user_id")
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  productId Int       @map("product_id")
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt DateTime  @default(now()) @map("created_at")

  @@unique([userId, productId])
  @@index([userId])
  @@map("favorites")
}
